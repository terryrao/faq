# 上下文切换
上下文切换是比较耗時的操作，当并发执行次数低于某个阀值时会比串行要慢

## 减少上下文切换

1. 无锁并发编程，如使用 ID 的 HASH 值取模分段，不同的线程使处理不同的数据
2. CAS 算法： atomic 包 来更新数据，不需要加锁
3. 使用最少线程：避免创建不需要的线程
4. 协程：在单线程里实现多任务调度

## 避免死锁
1. 避免在同一个线程同时获取多个锁
2. 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源
3. 尝试使用定时锁，使用 lock.tryLock 来代替
4. 对于数据库锁，加锁和解锁必须在在一个数据库连接里。

## 资源限制的挑战
资源限制是指在并发编程中，程序的执行速度受限于计算机硬件资源或者软件资源，比如说带宽，数据库连接。

资源限制引发的问题：受限于资源，相比于串行会增加上下文切换次数，反而会更慢

解决资源限制的问题：可以考虑集群并行，资源池复用，增强硬件。

资源限制下的并发编程：根据不同的资源限制调整程序的并发度。


